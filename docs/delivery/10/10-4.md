# [10-4] Custom Player Controls Overlay

[Back to task list](./tasks.md)

## Description

Implement custom video player controls overlay with volume control, quality selector, fullscreen toggle, and live indicator. The controls should auto-hide after inactivity, support keyboard shortcuts, and integrate with Zustand player store for volume persistence. No seek bar is included as this is live TV streaming.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-31 00:00:00 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2025-10-31 16:00:00 | Status Update | Proposed | InProgress | Started implementation | AI_Agent |
| 2025-10-31 16:45:00 | Status Update | InProgress | Review | Implementation complete, ready for review | AI_Agent |

## Requirements

### Functional Requirements
- Volume slider (0-100) with mute toggle
- Quality selector (1080p, 720p, 480p, Auto)
- Fullscreen button
- Live indicator (red dot + "LIVE" text)
- Controls fade out after 3 seconds of inactivity
- Controls show on hover/tap
- Keyboard shortcuts: Space (play/pause), F (fullscreen), M (mute), Arrow Up/Down (volume)
- NO seek bar (live content)
- Store volume in Zustand player store

### Technical Requirements
- Create `web/components/video/player-controls.tsx`
- Use existing Zustand `usePlayerStore` for volume state
- Use shadcn/ui components (Slider, Button, etc.)
- Retro styling consistent with app theme
- Accessible (ARIA labels, keyboard navigation)
- Touch-friendly controls on mobile

## Implementation Plan

### Step 1: Create controls component structure
```
web/components/video/player-controls.tsx
```

### Step 2: Implement control UI elements
- Volume slider with mute button
- Quality dropdown menu
- Fullscreen button
- Live indicator badge
- Position controls as overlay on video

### Step 3: Implement auto-hide behavior
```typescript
const [showControls, setShowControls] = useState(true);
const hideTimeout = useRef<NodeJS.Timeout>();

const handleMouseMove = () => {
  setShowControls(true);
  clearTimeout(hideTimeout.current);
  hideTimeout.current = setTimeout(() => {
    setShowControls(false);
  }, 3000);
};
```

### Step 4: Integrate Zustand player store
```typescript
const { volume, setVolume, isMuted, setMuted } = usePlayerStore();
```

### Step 5: Implement keyboard shortcuts
```typescript
useEffect(() => {
  const handleKeyDown = (e: KeyboardEvent) => {
    switch (e.key) {
      case ' ': // Space - play/pause
      case 'f': case 'F': // Fullscreen
      case 'm': case 'M': // Mute
      case 'ArrowUp': case 'ArrowDown': // Volume
    }
  };
  window.addEventListener('keydown', handleKeyDown);
  return () => window.removeEventListener('keydown', handleKeyDown);
}, []);
```

### Step 6: Implement quality switching
- Get HLS instance from parent
- Switch quality using HLS.js currentLevel API
- Update UI to show current quality

### Step 7: Add retro styling
- VCR-style buttons
- Shadow effects consistent with app
- Color scheme matching retro theme

## Test Plan

### Objective
Verify all controls work correctly and provide smooth user experience with proper auto-hide behavior.

### Test Scope
- Volume control and persistence
- Quality switching
- Fullscreen functionality
- Keyboard shortcuts
- Auto-hide timing
- Touch interactions on mobile
- Accessibility

### Success Criteria
- Volume changes persist across page reloads
- Quality selector switches streams correctly
- Fullscreen works in all browsers
- All keyboard shortcuts function
- Controls hide after 3 seconds
- Controls show on hover/tap
- Live indicator always visible
- Mobile-friendly touch targets

## Verification

### Acceptance Criteria
- [x] Component created at `web/components/video/player-controls.tsx`
- [x] Volume slider implemented and functional
- [x] Mute toggle works correctly
- [x] Quality selector shows all options (1080p, 720p, 480p, Auto)
- [x] Quality switching functional
- [x] Fullscreen button works
- [x] Live indicator displayed prominently
- [x] Controls auto-hide after 3 seconds
- [x] Controls show on hover/tap
- [x] Space key toggles play/pause
- [x] F key toggles fullscreen
- [x] M key toggles mute
- [x] Arrow Up/Down adjusts volume
- [x] Volume persists via Zustand store
- [x] No seek bar present
- [x] Retro styling matches app theme
- [x] Accessible with screen readers
- [x] Touch-friendly on mobile

### Definition of Done
- All acceptance criteria met
- Controls fully functional
- Keyboard shortcuts work
- Retro styling applied
- Ready for integration with video player

## Files Modified

### New Files Created
- `web/components/video/player-controls.tsx` - Custom controls overlay

### Modified Files
- `web/lib/stores/player-store.ts` - Verify volume/mute actions exist
- `web/components/video/index.ts` - Add export

### API Specifications Updated
- `docs/api-specs/frontend/frontend-api.md` - Document PlayerControls component

## Notes

- Quality switching requires HLS instance reference from parent
- Fullscreen API: `video.requestFullscreen()` and `document.exitFullscreen()`
- Live indicator should not fade with other controls
- Consider adding Picture-in-Picture button for future
- Volume range: 0-100 (video.volume expects 0.0-1.0, convert in handler)
- Keyboard events should be global, but only when player is in view
- Consider adding volume/quality tooltips with current values


