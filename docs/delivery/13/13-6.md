# [13-6] Observability for HLS pipeline

[Back to task list](./tasks.md)

## Description

Add actionable logs and metrics to track segment cadence, observed max segment duration, playlist update latency, current window size, and last successful write, to aid operations and troubleshooting.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-11-11 12:00:00 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

### Functional Requirements
- Log on each segment detection and playlist write event.
- Expose counters/gauges for cadence, drift, and window size.
- Provide a health/readiness indicator for the playlist service.

### Technical Requirements
- Follow existing logging patterns (zerolog or project standard).
- Consider lightweight metrics (expvar/prometheus endpoints) if available.
- Ensure logs are structured and sampled if noisy.

## Implementation Plan

1) Define metrics/log events and fields (channel, segment, durations).
2) Instrument watcher, manager, and process orchestration points.
3) Add a simple health endpoint or status function if applicable.
4) Validate logs under normal and error scenarios.

## Test Plan

### Objective
Ensure observability provides sufficient insight without excessive noise.

### Success Criteria
- Logs include key fields (channelId, seq, duration, windowLen).
- Metrics reflect current state and update on events.

## Verification

### Acceptance Criteria
- [ ] Structured logs at key points in the pipeline
- [ ] Metrics counters/gauges updated accurately
- [ ] Health/readiness indicator available

## Files Modified

### Modified/New Files
- `api/internal/streaming/playlist/watcher.go` — Add instrumentation
- `api/internal/streaming/playlist/manager.go` — Add instrumentation
- `api/internal/streaming/process.go` — Add lifecycle logging/metrics


