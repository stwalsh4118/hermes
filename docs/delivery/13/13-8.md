# [13-8] Unit and Integration Tests

[Back to task list](./tasks.md)

## Description

Create unit tests for playlist window logic and integration tests that simulate segment creation to validate end-to-end behavior (watching, playlist updates, pruning).

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-11-11 12:00:00 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

### Functional Requirements
- Unit test ring buffer append/prune, media sequence, target duration computation.
- Integration test pipeline reacting to synthetic segment creation cadence.
- Validate atomic writes and absence of partial playlist reads.

### Technical Requirements
- Use existing test harness patterns under `api/test/...`.
- Provide helpers to create/delete fake `.ts` files with expected naming.
- Ensure tests are deterministic and isolated.

## Implementation Plan

1) Unit tests for Playlist Manager (window, target duration, sequence).
2) Integration tests for watcher + manager combined.
3) Add negative tests (timestamp regression triggers discontinuity).

## Test Plan

### Objective
Ensure correctness of core logic and basic end-to-end pipeline behavior.

### Success Criteria
- All tests pass locally and in CI.
- Coverage on new code >= 80%.

## Verification

### Acceptance Criteria
- [ ] Unit tests validate playlist window/sequence/targetduration
- [ ] Integration tests validate detection/pruning/atomic writes
- [ ] Coverage >= 80% on new code paths

## Files Modified

### New Files Created
- `api/test/unit/streaming/playlist_manager_test.go`
- `api/test/integration/streaming/hls_pipeline_test.go`


