# [4-1] Define Timeline Types

[Back to task list](./tasks.md)

## Description

Create type definitions for the timeline calculation system. This includes the `TimelinePosition` struct that represents the current playback state of a channel, along with supporting types and constants. These types form the contract between the calculator, service, and API layers.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-30 00:00:00 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2025-10-30 00:01:00 | Status Change | Proposed | Agreed | Task approved | User |
| 2025-10-30 00:02:00 | Status Change | Agreed | InProgress | Starting implementation | AI_Agent |
| 2025-10-30 00:05:00 | Status Change | InProgress | Review | Types defined and documented | AI_Agent |
| 2025-10-30 00:06:00 | Status Change | Review | Done | Task approved | User |

## Requirements

### Functional Requirements
- Define `TimelinePosition` struct with all required fields
- Define error states for edge cases (empty playlist, not started, finished)
- Define constants for timeline calculations
- Ensure types are JSON-serializable for API responses
- Use appropriate Go types (time.Time, int64, uuid.UUID)

### Technical Requirements
- Create `api/internal/timeline/types.go`
- Follow existing project patterns (see models package)
- Use proper JSON tags for API serialization
- Include validation-ready struct tags
- Document all exported types and fields

### Data Structure

Based on PRD requirements, `TimelinePosition` must include:
- `MediaID` - UUID of the currently playing media
- `MediaTitle` - Title of the media for display
- `OffsetSeconds` - Position within the current media item
- `StartedAt` - When this media item started playing
- `EndsAt` - When this media item will end
- `Duration` - Total duration of the current media item

### Edge Case Types
- Empty playlist state
- Channel not started (current time < start time)
- Playlist finished (non-looping past end)

## Implementation Plan

### Step 1: Create timeline package
- Create directory `api/internal/timeline/`
- Create `types.go` file

### Step 2: Define TimelinePosition struct
- Add all required fields with proper types
- Add JSON tags matching API spec format
- Add struct documentation

### Step 3: Define edge case error types
- Create constants or special marker values
- Ensure they can be distinguished from success cases

### Step 4: Define timeline constants
- Any calculation-related constants (if needed)
- Error messages or state indicators

## Test Plan

### Objective
Verify type definitions are complete, follow project conventions, and compile correctly.

### Success Criteria
- TypeScript compilation passes without errors
- Types match the data contracts specified in PRD
- JSON serialization produces expected field names
- All exported types are documented

## Verification

### Acceptance Criteria
- [ ] `TimelinePosition` struct created with all required fields
- [ ] Proper JSON tags on all fields
- [ ] Edge case types/states defined
- [ ] All types are exported and documented
- [ ] Code compiles without errors
- [ ] Follows project naming conventions

### Definition of Done
- All acceptance criteria met
- Code follows Go best practices
- No linter errors
- Types ready for use by calculator and service layers

## Files Modified

### New Files Created
- `api/internal/timeline/types.go` - Timeline type definitions

### API Specifications Updated
- `docs/api-specs/timeline/timeline-api.md` - Document TimelinePosition and related types

## Notes

- These types form the contract between all timeline components
- Must be JSON-serializable for REST API responses
- Consider future extensibility (EPG will use similar concepts)
- Edge cases should be represented as error types or special states
- Duration fields in seconds (int64) for consistency with media model

