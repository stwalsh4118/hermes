# [7-6] Create routing structure and layouts

[Back to task list](./tasks.md)

## Description

Implement the App Router structure with routes for channels, library, and settings pages. Create reusable layout components including the main layout wrapper, content container, and page headers. Set up route navigation and 404 error page.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-27 14:00:00 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2025-10-28 20:30:00 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2025-10-28 21:15:00 | Status Change | InProgress | Review | All routes and layouts created, build passes | AI_Agent |

## Requirements

### Functional Requirements
- Create page routes for all main sections
- Implement layout components for consistent page structure
- Create 404 error page
- Set up loading states for route transitions
- Create page header component
- Implement breadcrumbs (optional)

### Technical Requirements
- Use Next.js 15 App Router conventions
- Implement nested layouts where appropriate
- Support dynamic route segments
- Proper TypeScript types for route params
- Responsive layouts for mobile and desktop

### Routes to Create
- `/` - Home/Dashboard
- `/channels` - Channel list
- `/channels/[id]` - Channel player
- `/channels/[id]/edit` - Edit channel
- `/channels/new` - Create new channel
- `/library` - Media library
- `/settings` - Application settings

## Implementation Plan

### Step 1: Create Main Layout Component
Create `components/layout/main-layout.tsx`:
```typescript
import React from "react";
import { cn } from "@/lib/utils";

interface MainLayoutProps {
  children: React.ReactNode;
  className?: string;
}

export function MainLayout({ children, className }: MainLayoutProps) {
  return (
    <div className="min-h-screen bg-background">
      <div className={cn("container mx-auto px-4 py-6", className)}>
        {children}
      </div>
    </div>
  );
}
```

### Step 2: Create Page Header Component
Create `components/layout/page-header.tsx`:
```typescript
import React from "react";
import { Separator } from "@/components/ui/separator";

interface PageHeaderProps {
  title: string;
  description?: string;
  actions?: React.ReactNode;
}

export function PageHeader({ title, description, actions }: PageHeaderProps) {
  return (
    <div className="space-y-4">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-bold tracking-tight">{title}</h1>
          {description && (
            <p className="text-muted-foreground mt-2">{description}</p>
          )}
        </div>
        {actions && <div className="flex items-center gap-2">{actions}</div>}
      </div>
      <Separator />
    </div>
  );
}
```

### Step 3: Update Home Page
Update `app/page.tsx`:
```typescript
import { MainLayout } from "@/components/layout/main-layout";
import { PageHeader } from "@/components/layout/page-header";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import Link from "next/link";
import { Play, Library, Settings } from "lucide-react";

export default function Home() {
  return (
    <MainLayout>
      <PageHeader
        title="Dashboard"
        description="Welcome to Hermes - Your Virtual TV Channel Service"
      />
      
      <div className="grid gap-6 md:grid-cols-3 mt-6">
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Play className="h-5 w-5" />
              Channels
            </CardTitle>
            <CardDescription>
              Manage and stream your TV channels
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Button asChild className="w-full">
              <Link href="/channels">View Channels</Link>
            </Button>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Library className="h-5 w-5" />
              Media Library
            </CardTitle>
            <CardDescription>
              Browse and organize your media files
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Button asChild variant="secondary" className="w-full">
              <Link href="/library">Open Library</Link>
            </Button>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <Settings className="h-5 w-5" />
              Settings
            </CardTitle>
            <CardDescription>
              Configure your service settings
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Button asChild variant="outline" className="w-full">
              <Link href="/settings">Open Settings</Link>
            </Button>
          </CardContent>
        </Card>
      </div>
    </MainLayout>
  );
}
```

### Step 4: Create Channels Routes
Create `app/channels/page.tsx`:
```typescript
import { MainLayout } from "@/components/layout/main-layout";
import { PageHeader } from "@/components/layout/page-header";
import { Button } from "@/components/ui/button";
import Link from "next/link";
import { Plus } from "lucide-react";

export default function ChannelsPage() {
  return (
    <MainLayout>
      <PageHeader
        title="Channels"
        description="Manage your virtual TV channels"
        actions={
          <Button asChild>
            <Link href="/channels/new">
              <Plus className="h-4 w-4 mr-2" />
              New Channel
            </Link>
          </Button>
        }
      />
      <div className="mt-6">
        <p className="text-muted-foreground">Channel list will be implemented in PBI-8</p>
      </div>
    </MainLayout>
  );
}
```

Create `app/channels/[id]/page.tsx`:
```typescript
import { MainLayout } from "@/components/layout/main-layout";
import { PageHeader } from "@/components/layout/page-header";
import { Button } from "@/components/ui/button";
import Link from "next/link";
import { Pencil } from "lucide-react";

export default function ChannelPlayerPage({
  params,
}: {
  params: { id: string };
}) {
  return (
    <MainLayout>
      <PageHeader
        title={`Channel ${params.id}`}
        description="Live channel player"
        actions={
          <Button asChild variant="outline">
            <Link href={`/channels/${params.id}/edit`}>
              <Pencil className="h-4 w-4 mr-2" />
              Edit
            </Link>
          </Button>
        }
      />
      <div className="mt-6">
        <p className="text-muted-foreground">
          Channel player will be implemented in PBI-10
        </p>
      </div>
    </MainLayout>
  );
}
```

Create `app/channels/[id]/edit/page.tsx`:
```typescript
import { MainLayout } from "@/components/layout/main-layout";
import { PageHeader } from "@/components/layout/page-header";

export default function EditChannelPage({
  params,
}: {
  params: { id: string };
}) {
  return (
    <MainLayout>
      <PageHeader
        title={`Edit Channel ${params.id}`}
        description="Update channel settings and playlist"
      />
      <div className="mt-6">
        <p className="text-muted-foreground">
          Channel editor will be implemented in PBI-8
        </p>
      </div>
    </MainLayout>
  );
}
```

Create `app/channels/new/page.tsx`:
```typescript
import { MainLayout } from "@/components/layout/main-layout";
import { PageHeader } from "@/components/layout/page-header";

export default function NewChannelPage() {
  return (
    <MainLayout>
      <PageHeader
        title="Create New Channel"
        description="Set up a new virtual TV channel"
      />
      <div className="mt-6">
        <p className="text-muted-foreground">
          Channel creation form will be implemented in PBI-8
        </p>
      </div>
    </MainLayout>
  );
}
```

### Step 5: Create Library Route
Create `app/library/page.tsx`:
```typescript
import { MainLayout } from "@/components/layout/main-layout";
import { PageHeader } from "@/components/layout/page-header";
import { Button } from "@/components/ui/button";
import { RefreshCw } from "lucide-react";

export default function LibraryPage() {
  return (
    <MainLayout>
      <PageHeader
        title="Media Library"
        description="Browse and manage your media files"
        actions={
          <Button variant="outline">
            <RefreshCw className="h-4 w-4 mr-2" />
            Scan Library
          </Button>
        }
      />
      <div className="mt-6">
        <p className="text-muted-foreground">
          Media library interface will be implemented in PBI-9
        </p>
      </div>
    </MainLayout>
  );
}
```

### Step 6: Create Settings Route
Create `app/settings/page.tsx`:
```typescript
import { MainLayout } from "@/components/layout/main-layout";
import { PageHeader } from "@/components/layout/page-header";

export default function SettingsPage() {
  return (
    <MainLayout>
      <PageHeader
        title="Settings"
        description="Configure your service preferences"
      />
      <div className="mt-6">
        <p className="text-muted-foreground">
          Settings interface will be implemented in PBI-11
        </p>
      </div>
    </MainLayout>
  );
}
```

### Step 7: Create 404 Not Found Page
Create `app/not-found.tsx`:
```typescript
import { MainLayout } from "@/components/layout/main-layout";
import { Button } from "@/components/ui/button";
import Link from "next/link";
import { Home } from "lucide-react";

export default function NotFound() {
  return (
    <MainLayout>
      <div className="flex flex-col items-center justify-center min-h-[60vh] space-y-4">
        <h1 className="text-6xl font-bold">404</h1>
        <h2 className="text-2xl font-semibold">Page Not Found</h2>
        <p className="text-muted-foreground text-center max-w-md">
          The page you're looking for doesn't exist or has been moved.
        </p>
        <Button asChild>
          <Link href="/">
            <Home className="h-4 w-4 mr-2" />
            Back to Home
          </Link>
        </Button>
      </div>
    </MainLayout>
  );
}
```

### Step 8: Create Loading States
Create `app/loading.tsx`:
```typescript
import { MainLayout } from "@/components/layout/main-layout";
import { Skeleton } from "@/components/ui/skeleton";

export default function Loading() {
  return (
    <MainLayout>
      <div className="space-y-4">
        <Skeleton className="h-12 w-64" />
        <Skeleton className="h-4 w-96" />
        <div className="grid gap-6 md:grid-cols-3 mt-6">
          <Skeleton className="h-48 w-full" />
          <Skeleton className="h-48 w-full" />
          <Skeleton className="h-48 w-full" />
        </div>
      </div>
    </MainLayout>
  );
}
```

Create `app/channels/loading.tsx`:
```typescript
import { MainLayout } from "@/components/layout/main-layout";
import { Skeleton } from "@/components/ui/skeleton";

export default function ChannelsLoading() {
  return (
    <MainLayout>
      <div className="space-y-4">
        <Skeleton className="h-12 w-48" />
        <Skeleton className="h-4 w-96" />
        <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3 mt-6">
          {[...Array(6)].map((_, i) => (
            <Skeleton key={i} className="h-64 w-full" />
          ))}
        </div>
      </div>
    </MainLayout>
  );
}
```

### Step 9: Test Navigation
- Visit each route: `/`, `/channels`, `/library`, `/settings`
- Test dynamic routes: `/channels/test-123`
- Test 404: visit `/nonexistent`
- Verify loading states appear during navigation
- Check responsive layouts on mobile and desktop

### Step 10: Verify Build
```bash
cd web
pnpm build
```
Ensure all routes build successfully.

## Test Plan

### Success Criteria
1. All routes render correctly
2. Dynamic routes work with params
3. 404 page displays for invalid routes
4. Loading states show during navigation
5. Layouts are responsive
6. Navigation between routes works
7. Build completes successfully

### Manual Testing
1. **Route Navigation**
   - Click links on home page
   - Navigate to each section
   - Use browser back/forward
   - Verify smooth transitions

2. **Dynamic Routes**
   - Visit `/channels/123`
   - Visit `/channels/abc`
   - Verify params are passed correctly

3. **Error Handling**
   - Visit `/invalid-route`
   - Verify 404 page displays
   - Click "Back to Home" button

4. **Responsive Design**
   - Test on mobile viewport
   - Test on tablet viewport
   - Test on desktop viewport
   - Verify layouts adapt properly

## Verification

### Acceptance Criteria
- [ ] MainLayout component created
- [ ] PageHeader component created
- [ ] Home page updated with navigation cards
- [ ] Channels list page created
- [ ] Channel player page created (dynamic route)
- [ ] Edit channel page created (nested dynamic route)
- [ ] New channel page created
- [ ] Library page created
- [ ] Settings page created
- [ ] 404 not-found page created
- [ ] Loading state for root created
- [ ] Loading state for channels created
- [ ] All routes accessible via navigation
- [ ] Dynamic routes receive params correctly
- [ ] 404 page displays for invalid routes
- [ ] Layouts are responsive
- [ ] Build completes without errors
- [ ] No TypeScript errors

### Definition of Done
- All acceptance criteria met
- All routes render correctly
- Navigation works smoothly
- Error pages handle edge cases
- Responsive design works across devices
- Code is well-organized and follows best practices

## Files Modified

### New Files Created
- `components/layout/main-layout.tsx` - Main layout wrapper
- `components/layout/page-header.tsx` - Page header component
- `app/page.tsx` - Updated home page
- `app/channels/page.tsx` - Channels list page
- `app/channels/[id]/page.tsx` - Channel player page
- `app/channels/[id]/edit/page.tsx` - Edit channel page
- `app/channels/new/page.tsx` - New channel page
- `app/library/page.tsx` - Media library page
- `app/settings/page.tsx` - Settings page
- `app/not-found.tsx` - 404 error page
- `app/loading.tsx` - Root loading state
- `app/channels/loading.tsx` - Channels loading state

## Notes

- App Router uses file-system based routing
- `[id]` denotes a dynamic route segment
- `loading.tsx` files provide automatic loading UI
- `not-found.tsx` handles 404 errors
- Layouts can be nested for shared UI
- All pages are Server Components by default (add "use client" when needed)
- MainLayout provides consistent padding and responsive container
- PageHeader provides consistent page titles and action buttons
- Placeholder text indicates where future PBIs will add functionality

