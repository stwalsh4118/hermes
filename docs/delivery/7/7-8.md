# [7-8] Create common components (loading, error states)

[Back to task list](./tasks.md)

## Description

Build reusable common components for loading states, error messages, empty states, and data display patterns. These components will be used throughout the application to provide consistent UX for various states and scenarios.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-27 14:00:00 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2025-10-28 23:50:00 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2025-10-29 00:15:00 | Status Change | InProgress | Review | All components created, build passes, ready for review | AI_Agent |
| 2025-10-29 00:45:00 | Status Change | Review | Done | All components working, visibility issues fixed, approved | User |

## Requirements

### Functional Requirements
- Create loading spinner component
- Create skeleton loaders for different content types
- Create error message component
- Create empty state component
- Create data display wrapper with loading/error/empty handling
- Create confirmation dialog component

### Technical Requirements
- Components must be reusable and composable
- Support theming (light/dark mode)
- Accessible (ARIA labels, semantic HTML)
- TypeScript types for all props
- Integration with existing UI components

### Components to Create
- LoadingSpinner
- SkeletonCard
- SkeletonList
- ErrorMessage
- EmptyState
- DataWrapper
- ConfirmDialog

## Implementation Plan

### Step 1: Create Loading Spinner
Create `components/common/loading-spinner.tsx`:
```typescript
import { Loader2 } from "lucide-react";
import { cn } from "@/lib/utils";

interface LoadingSpinnerProps {
  size?: "sm" | "md" | "lg";
  className?: string;
}

export function LoadingSpinner({ size = "md", className }: LoadingSpinnerProps) {
  const sizeClasses = {
    sm: "h-4 w-4",
    md: "h-8 w-8",
    lg: "h-12 w-12",
  };

  return (
    <div className="flex items-center justify-center p-4">
      <Loader2 className={cn("animate-spin text-primary", sizeClasses[size], className)} />
    </div>
  );
}
```

### Step 2: Create Skeleton Components
Create `components/common/skeleton-card.tsx`:
```typescript
import { Card, CardContent, CardHeader } from "@/components/ui/card";
import { Skeleton } from "@/components/ui/skeleton";

export function SkeletonCard() {
  return (
    <Card>
      <CardHeader>
        <Skeleton className="h-6 w-3/4" />
        <Skeleton className="h-4 w-1/2 mt-2" />
      </CardHeader>
      <CardContent>
        <Skeleton className="h-40 w-full mb-4" />
        <Skeleton className="h-4 w-full mb-2" />
        <Skeleton className="h-4 w-5/6" />
      </CardContent>
    </Card>
  );
}
```

Create `components/common/skeleton-list.tsx`:
```typescript
import { Skeleton } from "@/components/ui/skeleton";

interface SkeletonListProps {
  count?: number;
}

export function SkeletonList({ count = 5 }: SkeletonListProps) {
  return (
    <div className="space-y-4">
      {[...Array(count)].map((_, i) => (
        <div key={i} className="flex items-center gap-4">
          <Skeleton className="h-12 w-12 rounded-full" />
          <div className="flex-1 space-y-2">
            <Skeleton className="h-4 w-3/4" />
            <Skeleton className="h-3 w-1/2" />
          </div>
        </div>
      ))}
    </div>
  );
}
```

### Step 3: Create Error Message Component
Create `components/common/error-message.tsx`:
```typescript
import { AlertCircle, RefreshCw } from "lucide-react";
import { Alert, AlertDescription, AlertTitle } from "@/components/ui/alert";
import { Button } from "@/components/ui/button";

interface ErrorMessageProps {
  title?: string;
  message: string;
  onRetry?: () => void;
  showIcon?: boolean;
}

export function ErrorMessage({
  title = "Error",
  message,
  onRetry,
  showIcon = true,
}: ErrorMessageProps) {
  return (
    <Alert variant="destructive">
      {showIcon && <AlertCircle className="h-4 w-4" />}
      <AlertTitle>{title}</AlertTitle>
      <AlertDescription className="mt-2">
        {message}
        {onRetry && (
          <Button
            variant="outline"
            size="sm"
            onClick={onRetry}
            className="mt-4"
          >
            <RefreshCw className="h-4 w-4 mr-2" />
            Try Again
          </Button>
        )}
      </AlertDescription>
    </Alert>
  );
}
```

### Step 4: Create Empty State Component
Create `components/common/empty-state.tsx`:
```typescript
import { LucideIcon } from "lucide-react";
import { Button } from "@/components/ui/button";

interface EmptyStateProps {
  icon?: LucideIcon;
  title: string;
  description: string;
  action?: {
    label: string;
    onClick: () => void;
  };
}

export function EmptyState({ icon: Icon, title, description, action }: EmptyStateProps) {
  return (
    <div className="flex flex-col items-center justify-center p-8 text-center">
      {Icon && (
        <div className="rounded-full bg-muted p-4 mb-4">
          <Icon className="h-10 w-10 text-muted-foreground" />
        </div>
      )}
      <h3 className="text-lg font-semibold mb-2">{title}</h3>
      <p className="text-muted-foreground max-w-md mb-4">{description}</p>
      {action && (
        <Button onClick={action.onClick}>{action.label}</Button>
      )}
    </div>
  );
}
```

### Step 5: Create Data Wrapper Component
Create `components/common/data-wrapper.tsx`:
```typescript
import React from "react";
import { LoadingSpinner } from "./loading-spinner";
import { ErrorMessage } from "./error-message";
import { EmptyState } from "./empty-state";
import { LucideIcon } from "lucide-react";

interface DataWrapperProps<T> {
  data: T | undefined;
  isLoading: boolean;
  error: Error | null;
  isEmpty?: (data: T) => boolean;
  emptyState?: {
    icon?: LucideIcon;
    title: string;
    description: string;
    action?: {
      label: string;
      onClick: () => void;
    };
  };
  onRetry?: () => void;
  children: (data: T) => React.ReactNode;
}

export function DataWrapper<T>({
  data,
  isLoading,
  error,
  isEmpty,
  emptyState,
  onRetry,
  children,
}: DataWrapperProps<T>) {
  if (isLoading) {
    return <LoadingSpinner />;
  }

  if (error) {
    return (
      <ErrorMessage
        message={error.message || "An error occurred"}
        onRetry={onRetry}
      />
    );
  }

  if (!data || (isEmpty && isEmpty(data))) {
    if (emptyState) {
      return <EmptyState {...emptyState} />;
    }
    return (
      <EmptyState
        title="No data"
        description="There's nothing to display here yet."
      />
    );
  }

  return <>{children(data)}</>;
}
```

### Step 6: Create Confirm Dialog Component
Create `components/common/confirm-dialog.tsx`:
```typescript
"use client";

import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from "@/components/ui/alert-dialog";

interface ConfirmDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  title: string;
  description: string;
  confirmLabel?: string;
  cancelLabel?: string;
  onConfirm: () => void;
  variant?: "default" | "destructive";
}

export function ConfirmDialog({
  open,
  onOpenChange,
  title,
  description,
  confirmLabel = "Continue",
  cancelLabel = "Cancel",
  onConfirm,
  variant = "default",
}: ConfirmDialogProps) {
  return (
    <AlertDialog open={open} onOpenChange={onOpenChange}>
      <AlertDialogContent>
        <AlertDialogHeader>
          <AlertDialogTitle>{title}</AlertDialogTitle>
          <AlertDialogDescription>{description}</AlertDialogDescription>
        </AlertDialogHeader>
        <AlertDialogFooter>
          <AlertDialogCancel>{cancelLabel}</AlertDialogCancel>
          <AlertDialogAction
            onClick={onConfirm}
            className={variant === "destructive" ? "bg-destructive text-destructive-foreground hover:bg-destructive/90" : ""}
          >
            {confirmLabel}
          </AlertDialogAction>
        </AlertDialogFooter>
      </AlertDialogContent>
    </AlertDialog>
  );
}
```

### Step 7: Install Alert Dialog Component
```bash
cd web
pnpm dlx shadcn@latest add alert-dialog
pnpm dlx shadcn@latest add alert
```

### Step 8: Create Component Showcase
Update `app/components/page.tsx` to include new components:
```typescript
"use client";

import { useState } from "react";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Separator } from "@/components/ui/separator";
import { LoadingSpinner } from "@/components/common/loading-spinner";
import { SkeletonCard } from "@/components/common/skeleton-card";
import { SkeletonList } from "@/components/common/skeleton-list";
import { ErrorMessage } from "@/components/common/error-message";
import { EmptyState } from "@/components/common/empty-state";
import { ConfirmDialog } from "@/components/common/confirm-dialog";
import { InboxIcon, Plus } from "lucide-react";

export default function ComponentsPage() {
  const [confirmOpen, setConfirmOpen] = useState(false);

  return (
    <div className="container mx-auto py-10 space-y-8">
      <div>
        <h1 className="text-4xl font-bold mb-2">Common Components</h1>
        <p className="text-muted-foreground">Loading, error, and empty states</p>
      </div>

      <Separator />

      <Card>
        <CardHeader>
          <CardTitle>Loading Spinner</CardTitle>
        </CardHeader>
        <CardContent className="flex gap-4">
          <LoadingSpinner size="sm" />
          <LoadingSpinner size="md" />
          <LoadingSpinner size="lg" />
        </CardContent>
      </Card>

      <Card>
        <CardHeader>
          <CardTitle>Skeleton Card</CardTitle>
        </CardHeader>
        <CardContent>
          <SkeletonCard />
        </CardContent>
      </Card>

      <Card>
        <CardHeader>
          <CardTitle>Skeleton List</CardTitle>
        </CardHeader>
        <CardContent>
          <SkeletonList count={3} />
        </CardContent>
      </Card>

      <Card>
        <CardHeader>
          <CardTitle>Error Message</CardTitle>
        </CardHeader>
        <CardContent>
          <ErrorMessage
            message="Failed to load data from the server"
            onRetry={() => alert("Retrying...")}
          />
        </CardContent>
      </Card>

      <Card>
        <CardHeader>
          <CardTitle>Empty State</CardTitle>
        </CardHeader>
        <CardContent>
          <EmptyState
            icon={InboxIcon}
            title="No channels yet"
            description="Get started by creating your first TV channel"
            action={{
              label: "Create Channel",
              onClick: () => alert("Create channel clicked"),
            }}
          />
        </CardContent>
      </Card>

      <Card>
        <CardHeader>
          <CardTitle>Confirm Dialog</CardTitle>
        </CardHeader>
        <CardContent>
          <Button onClick={() => setConfirmOpen(true)}>
            Open Confirm Dialog
          </Button>
          <ConfirmDialog
            open={confirmOpen}
            onOpenChange={setConfirmOpen}
            title="Are you sure?"
            description="This action cannot be undone. This will permanently delete the channel."
            confirmLabel="Delete"
            cancelLabel="Cancel"
            variant="destructive"
            onConfirm={() => {
              alert("Confirmed!");
              setConfirmOpen(false);
            }}
          />
        </CardContent>
      </Card>
    </div>
  );
}
```

### Step 9: Create Common Components Index
Create `components/common/index.ts`:
```typescript
export { LoadingSpinner } from "./loading-spinner";
export { SkeletonCard } from "./skeleton-card";
export { SkeletonList } from "./skeleton-list";
export { ErrorMessage } from "./error-message";
export { EmptyState } from "./empty-state";
export { DataWrapper } from "./data-wrapper";
export { ConfirmDialog } from "./confirm-dialog";
export { ThemeToggle } from "./theme-toggle";
```

### Step 10: Test Components
- Visit `/components` page
- Test loading spinner sizes
- Test skeleton components
- Test error message with retry
- Test empty state with action
- Test confirm dialog
- Verify dark mode support
- Test keyboard interactions

## Test Plan

This task involves UI components with visual verification.

### Success Criteria
1. All components render correctly
2. Components adapt to theme changes
3. Interactive components work (buttons, dialogs)
4. Accessible (keyboard navigation, ARIA)
5. TypeScript types are correct
6. Components are reusable

### Manual Testing
1. **Loading States**
   - Verify spinner animates
   - Check skeleton loaders match content shapes

2. **Error States**
   - Verify error message displays
   - Test retry button functionality

3. **Empty States**
   - Verify icon displays
   - Test action button

4. **Confirm Dialog**
   - Open dialog
   - Test cancel button
   - Test confirm button
   - Test ESC key to close
   - Test backdrop click to close

5. **Theme Support**
   - Toggle between light and dark mode
   - Verify all components adapt correctly

## Verification

### Acceptance Criteria
- [ ] LoadingSpinner component created with size variants
- [ ] SkeletonCard component created
- [ ] SkeletonList component created with configurable count
- [ ] ErrorMessage component created with retry option
- [ ] EmptyState component created with action support
- [ ] DataWrapper component created for unified loading/error/empty handling
- [ ] ConfirmDialog component created
- [ ] Alert and AlertDialog shadcn components installed
- [ ] Components showcase page updated
- [ ] Common components index file created
- [ ] All components support dark mode
- [ ] All components are accessible
- [ ] TypeScript types defined for all props
- [ ] No TypeScript errors
- [ ] Components work with keyboard navigation

### Definition of Done
- All acceptance criteria met
- Components are visually polished
- Animations are smooth
- Accessibility standards met
- Code is well-documented
- Components are reusable across the app

## Files Modified

### New Files Created
- `components/common/loading-spinner.tsx` - Loading spinner component
- `components/common/skeleton-card.tsx` - Card skeleton loader
- `components/common/skeleton-list.tsx` - List skeleton loader
- `components/common/error-message.tsx` - Error display component
- `components/common/empty-state.tsx` - Empty state component
- `components/common/data-wrapper.tsx` - Data display wrapper
- `components/common/confirm-dialog.tsx` - Confirmation dialog
- `components/common/index.ts` - Common components exports
- `components/ui/alert-dialog.tsx` - shadcn alert dialog (via CLI)
- `components/ui/alert.tsx` - shadcn alert (via CLI)

### Files Modified
- `app/components/page.tsx` - Added common components showcase
- `package.json` - Dependencies updated by shadcn CLI

## Notes

- LoadingSpinner uses Loader2 icon from lucide-react for consistent spin animation
- Skeleton components use shadcn/ui Skeleton primitive
- ErrorMessage uses shadcn/ui Alert component
- EmptyState is flexible and accepts custom icons and actions
- DataWrapper is a render props pattern component for cleaner data fetching code
- ConfirmDialog uses shadcn/ui AlertDialog for accessibility
- All components support theme switching automatically
- Components follow composition patterns for maximum reusability
- Loading states should match the shape of the content they represent (skeleton loaders)

