# [7-2] Set up Tailwind CSS with dark mode theming

[Back to task list](./tasks.md)

## Description

Configure Tailwind CSS with a custom design system including colors, typography, spacing, and full dark mode support using next-themes. This establishes the visual foundation and theming system for the entire application.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-27 14:00:00 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

### Functional Requirements
- Configure Tailwind CSS with custom theme
- Implement dark mode support with system preference detection
- Create CSS custom properties for theme colors
- Configure typography plugin for better text rendering
- Set up dark mode toggle functionality
- Support both light and dark themes

### Technical Requirements
- Use next-themes for dark mode management
- Configure Tailwind with custom colors matching design system
- Enable JIT (Just-In-Time) compilation
- Configure content paths for proper purging
- Add Tailwind typography plugin
- Use CSS custom properties for runtime theme switching

### Design System Colors
- Primary: Blue palette for main actions
- Secondary: Gray palette for backgrounds and text
- Success: Green for positive actions
- Warning: Yellow/Orange for warnings
- Error: Red for errors
- Neutral: Gray scale for UI elements

## Implementation Plan

### Step 1: Install Dependencies
```bash
cd web
pnpm add next-themes
pnpm add -D @tailwindcss/typography @tailwindcss/forms
```

### Step 2: Update Tailwind Config
Update `tailwind.config.ts`:
```typescript
import type { Config } from "tailwindcss";

const config: Config = {
  darkMode: ["class"],
  content: [
    "./pages/**/*.{js,ts,jsx,tsx,mdx}",
    "./components/**/*.{js,ts,jsx,tsx,mdx}",
    "./app/**/*.{js,ts,jsx,tsx,mdx}",
  ],
  theme: {
    extend: {
      colors: {
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        primary: {
          DEFAULT: "hsl(var(--primary))",
          foreground: "hsl(var(--primary-foreground))",
        },
        secondary: {
          DEFAULT: "hsl(var(--secondary))",
          foreground: "hsl(var(--secondary-foreground))",
        },
        destructive: {
          DEFAULT: "hsl(var(--destructive))",
          foreground: "hsl(var(--destructive-foreground))",
        },
        muted: {
          DEFAULT: "hsl(var(--muted))",
          foreground: "hsl(var(--muted-foreground))",
        },
        accent: {
          DEFAULT: "hsl(var(--accent))",
          foreground: "hsl(var(--accent-foreground))",
        },
        popover: {
          DEFAULT: "hsl(var(--popover))",
          foreground: "hsl(var(--popover-foreground))",
        },
        card: {
          DEFAULT: "hsl(var(--card))",
          foreground: "hsl(var(--card-foreground))",
        },
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
    },
  },
  plugins: [
    require("@tailwindcss/typography"),
    require("@tailwindcss/forms"),
  ],
};

export default config;
```

### Step 3: Update Global Styles
Update `app/globals.css`:
```css
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;
    --card: 0 0% 100%;
    --card-foreground: 222.2 84% 4.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 222.2 84% 4.9%;
    --primary: 221.2 83.2% 53.3%;
    --primary-foreground: 210 40% 98%;
    --secondary: 210 40% 96.1%;
    --secondary-foreground: 222.2 47.4% 11.2%;
    --muted: 210 40% 96.1%;
    --muted-foreground: 215.4 16.3% 46.9%;
    --accent: 210 40% 96.1%;
    --accent-foreground: 222.2 47.4% 11.2%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;
    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 221.2 83.2% 53.3%;
    --radius: 0.5rem;
  }

  .dark {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;
    --card: 222.2 84% 4.9%;
    --card-foreground: 210 40% 98%;
    --popover: 222.2 84% 4.9%;
    --popover-foreground: 210 40% 98%;
    --primary: 217.2 91.2% 59.8%;
    --primary-foreground: 222.2 47.4% 11.2%;
    --secondary: 217.2 32.6% 17.5%;
    --secondary-foreground: 210 40% 98%;
    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;
    --accent: 217.2 32.6% 17.5%;
    --accent-foreground: 210 40% 98%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;
    --border: 217.2 32.6% 17.5%;
    --input: 217.2 32.6% 17.5%;
    --ring: 224.3 76.3% 48%;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
  }
}
```

### Step 4: Create Theme Provider
Create `components/providers/theme-provider.tsx`:
```typescript
"use client";

import * as React from "react";
import { ThemeProvider as NextThemesProvider } from "next-themes";
import { type ThemeProviderProps } from "next-themes/dist/types";

export function ThemeProvider({ children, ...props }: ThemeProviderProps) {
  return <NextThemesProvider {...props}>{children}</NextThemesProvider>;
}
```

### Step 5: Update Root Layout
Update `app/layout.tsx` to include theme provider:
```typescript
import type { Metadata } from "next";
import { Inter } from "next/font/google";
import "./globals.css";
import { ThemeProvider } from "@/components/providers/theme-provider";

const inter = Inter({ subsets: ["latin"] });

export const metadata: Metadata = {
  title: "Hermes - Virtual TV Channel Service",
  description: "Manage and stream your own virtual TV channels",
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en" suppressHydrationWarning>
      <body className={inter.className}>
        <ThemeProvider
          attribute="class"
          defaultTheme="system"
          enableSystem
          disableTransitionOnChange
        >
          {children}
        </ThemeProvider>
      </body>
    </html>
  );
}
```

### Step 6: Create Theme Toggle Component
Create `components/common/theme-toggle.tsx`:
```typescript
"use client";

import * as React from "react";
import { Moon, Sun } from "lucide-react";
import { useTheme } from "next-themes";

export function ThemeToggle() {
  const { theme, setTheme } = useTheme();
  const [mounted, setMounted] = React.useState(false);

  React.useEffect(() => {
    setMounted(true);
  }, []);

  if (!mounted) {
    return null;
  }

  return (
    <button
      onClick={() => setTheme(theme === "dark" ? "light" : "dark")}
      className="rounded-md p-2 hover:bg-accent"
      aria-label="Toggle theme"
    >
      {theme === "dark" ? (
        <Sun className="h-5 w-5" />
      ) : (
        <Moon className="h-5 w-5" />
      )}
    </button>
  );
}
```

### Step 7: Update Home Page to Demo Theme
Update `app/page.tsx` to include theme toggle:
```typescript
import { ThemeToggle } from "@/components/common/theme-toggle";

export default function Home() {
  return (
    <main className="flex min-h-screen flex-col items-center justify-center p-24">
      <div className="absolute top-4 right-4">
        <ThemeToggle />
      </div>
      <h1 className="text-4xl font-bold">Hermes</h1>
      <p className="mt-4 text-lg text-muted-foreground">
        Virtual TV Channel Service
      </p>
      <div className="mt-8 p-4 rounded-lg border bg-card text-card-foreground">
        <p>Theme toggle is working! Try switching themes.</p>
      </div>
    </main>
  );
}
```

### Step 8: Configure Path Aliases
Ensure `tsconfig.json` has path alias for @:
```json
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./*"]
    }
  }
}
```

### Step 9: Install Lucide Icons
```bash
cd web
pnpm add lucide-react
```

### Step 10: Verify Theme Switching
- Start dev server
- Toggle theme using the button
- Verify colors change appropriately
- Check system theme detection works

## Test Plan

### Manual Testing
1. **Theme Toggle**
   - Click theme toggle button
   - Verify page switches between light and dark mode
   - Check all colors update correctly

2. **System Theme Detection**
   - Change OS theme preference
   - Verify app follows system theme on first load

3. **Theme Persistence**
   - Toggle theme
   - Refresh page
   - Verify theme persists

4. **CSS Custom Properties**
   - Inspect element in dev tools
   - Verify CSS custom properties are applied
   - Check values change with theme

5. **No Flash of Unstyled Content**
   - Refresh page in dark mode
   - Verify no white flash appears

### Success Criteria
- Theme toggles smoothly between light and dark
- System theme preference is detected and applied
- Theme preference persists across page reloads
- No flash of unstyled content on page load
- All Tailwind utilities work correctly
- Typography plugin enhances text rendering

## Verification

### Acceptance Criteria
- [ ] Tailwind CSS configured with custom theme
- [ ] Dark mode implemented with next-themes
- [ ] CSS custom properties defined for all theme colors
- [ ] Theme provider wraps application
- [ ] Theme toggle component functional
- [ ] System theme detection works
- [ ] Theme persists across reloads
- [ ] No flash of unstyled content
- [ ] Typography plugin installed and configured
- [ ] Forms plugin installed and configured
- [ ] Lucide icons library available
- [ ] Path alias (@/) configured and working

### Definition of Done
- All acceptance criteria met
- Theme switching works seamlessly
- Colors are consistent across light and dark modes
- No console errors or warnings
- Code follows accessibility best practices

## Files Modified

### New Files Created
- `components/providers/theme-provider.tsx` - Theme context provider
- `components/common/theme-toggle.tsx` - Theme toggle button component

### Files Modified
- `tailwind.config.ts` - Added custom theme colors and plugins
- `app/globals.css` - Added CSS custom properties for themes
- `app/layout.tsx` - Added ThemeProvider and Inter font
- `app/page.tsx` - Added theme toggle demo
- `tsconfig.json` - Confirmed/added @ path alias
- `package.json` - Added next-themes, typography, forms, lucide-react

### Directories Created
- `components/providers/` - Provider components directory

## Notes

- next-themes handles system preference detection automatically
- CSS custom properties allow runtime theme switching without page reload
- suppressHydrationWarning on html tag prevents hydration warnings with next-themes
- Theme toggle uses lucide-react icons (will be used throughout app)
- Typography and forms plugins enhance default Tailwind styles
- Color scheme uses HSL for better control and flexibility

