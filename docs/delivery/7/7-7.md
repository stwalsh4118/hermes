# [7-7] Implement navigation and header components

[Back to task list](./tasks.md)

## Description

Build the main navigation system including a responsive header with logo, navigation links, theme toggle, and mobile menu. Create a sidebar navigation component for desktop and a mobile menu drawer for small screens.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-27 14:00:00 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2025-10-28 22:30:00 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2025-10-28 23:15:00 | Status Change | InProgress | Review | All components created, build passes, ready for review | AI_Agent |
| 2025-10-28 23:45:00 | Status Change | Review | Done | All acceptance criteria met, navigation system complete | User |

## Requirements

### Functional Requirements
- Create header component with logo and navigation
- Implement responsive navigation (desktop and mobile)
- Add theme toggle to header
- Create mobile menu drawer
- Highlight active route
- Support nested navigation items

### Technical Requirements
- Responsive design (mobile-first)
- Accessible navigation (keyboard and screen reader)
- Smooth animations for mobile menu
- Active link highlighting
- Integration with Zustand UI store

### Navigation Structure
- Home
- Channels
- Library
- Settings

## Implementation Plan

### Step 1: Create Navigation Items Config
Create `lib/config/navigation.ts`:
```typescript
import { Home, Play, Library, Settings } from "lucide-react";
import { LucideIcon } from "lucide-react";

export interface NavItem {
  title: string;
  href: string;
  icon: LucideIcon;
  description?: string;
}

export const navItems: NavItem[] = [
  {
    title: "Home",
    href: "/",
    icon: Home,
    description: "Dashboard and overview",
  },
  {
    title: "Channels",
    href: "/channels",
    icon: Play,
    description: "Manage TV channels",
  },
  {
    title: "Library",
    href: "/library",
    icon: Library,
    description: "Browse media files",
  },
  {
    title: "Settings",
    href: "/settings",
    icon: Settings,
    description: "Configure preferences",
  },
];
```

### Step 2: Create Header Component
Create `components/layout/header.tsx`:
```typescript
"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";
import { Menu } from "lucide-react";
import { Button } from "@/components/ui/button";
import { ThemeToggle } from "@/components/common/theme-toggle";
import { useUIStore } from "@/lib/stores";
import { navItems } from "@/lib/config/navigation";
import { cn } from "@/lib/utils";

export function Header() {
  const pathname = usePathname();
  const { toggleMobileMenu } = useUIStore();

  return (
    <header className="sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
      <div className="container flex h-16 items-center justify-between px-4">
        {/* Logo */}
        <div className="flex items-center gap-6">
          <Link href="/" className="flex items-center space-x-2">
            <div className="flex h-8 w-8 items-center justify-center rounded-lg bg-primary">
              <span className="text-lg font-bold text-primary-foreground">H</span>
            </div>
            <span className="hidden font-bold sm:inline-block">Hermes</span>
          </Link>

          {/* Desktop Navigation */}
          <nav className="hidden md:flex items-center gap-1">
            {navItems.map((item) => {
              const Icon = item.icon;
              const isActive = pathname === item.href || 
                (item.href !== "/" && pathname.startsWith(item.href));
              
              return (
                <Link
                  key={item.href}
                  href={item.href}
                  className={cn(
                    "flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition-colors",
                    isActive
                      ? "bg-secondary text-foreground"
                      : "text-muted-foreground hover:bg-secondary/50 hover:text-foreground"
                  )}
                >
                  <Icon className="h-4 w-4" />
                  {item.title}
                </Link>
              );
            })}
          </nav>
        </div>

        {/* Right Side Actions */}
        <div className="flex items-center gap-2">
          <ThemeToggle />
          
          {/* Mobile Menu Button */}
          <Button
            variant="ghost"
            size="icon"
            className="md:hidden"
            onClick={toggleMobileMenu}
            aria-label="Toggle menu"
          >
            <Menu className="h-5 w-5" />
          </Button>
        </div>
      </div>
    </header>
  );
}
```

### Step 3: Create Mobile Menu Component
Create `components/layout/mobile-menu.tsx`:
```typescript
"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";
import { X } from "lucide-react";
import { Button } from "@/components/ui/button";
import { Separator } from "@/components/ui/separator";
import { useUIStore } from "@/lib/stores";
import { navItems } from "@/lib/config/navigation";
import { cn } from "@/lib/utils";
import { useEffect } from "react";

export function MobileMenu() {
  const pathname = usePathname();
  const { mobileMenuOpen, setMobileMenuOpen } = useUIStore();

  // Close menu when route changes
  useEffect(() => {
    setMobileMenuOpen(false);
  }, [pathname, setMobileMenuOpen]);

  // Prevent scroll when menu is open
  useEffect(() => {
    if (mobileMenuOpen) {
      document.body.style.overflow = "hidden";
    } else {
      document.body.style.overflow = "unset";
    }
    return () => {
      document.body.style.overflow = "unset";
    };
  }, [mobileMenuOpen]);

  if (!mobileMenuOpen) return null;

  return (
    <>
      {/* Backdrop */}
      <div
        className="fixed inset-0 z-50 bg-background/80 backdrop-blur-sm md:hidden"
        onClick={() => setMobileMenuOpen(false)}
      />

      {/* Menu Panel */}
      <div className="fixed inset-y-0 right-0 z-50 w-full max-w-xs border-l bg-background p-6 shadow-lg md:hidden">
        <div className="flex items-center justify-between mb-6">
          <h2 className="text-lg font-semibold">Menu</h2>
          <Button
            variant="ghost"
            size="icon"
            onClick={() => setMobileMenuOpen(false)}
            aria-label="Close menu"
          >
            <X className="h-5 w-5" />
          </Button>
        </div>

        <Separator className="mb-4" />

        <nav className="flex flex-col gap-1">
          {navItems.map((item) => {
            const Icon = item.icon;
            const isActive = pathname === item.href || 
              (item.href !== "/" && pathname.startsWith(item.href));

            return (
              <Link
                key={item.href}
                href={item.href}
                className={cn(
                  "flex items-center gap-3 rounded-lg px-3 py-3 text-sm font-medium transition-colors",
                  isActive
                    ? "bg-secondary text-foreground"
                    : "text-muted-foreground hover:bg-secondary/50 hover:text-foreground"
                )}
              >
                <Icon className="h-5 w-5" />
                <div>
                  <div>{item.title}</div>
                  {item.description && (
                    <div className="text-xs text-muted-foreground">
                      {item.description}
                    </div>
                  )}
                </div>
              </Link>
            );
          })}
        </nav>
      </div>
    </>
  );
}
```

### Step 4: Create App Shell Layout
Create `components/layout/app-shell.tsx`:
```typescript
import React from "react";
import { Header } from "./header";
import { MobileMenu } from "./mobile-menu";

interface AppShellProps {
  children: React.ReactNode;
}

export function AppShell({ children }: AppShellProps) {
  return (
    <div className="relative min-h-screen flex flex-col">
      <Header />
      <main className="flex-1">{children}</main>
      <MobileMenu />
    </div>
  );
}
```

### Step 5: Update Root Layout
Update `app/layout.tsx`:
```typescript
import type { Metadata } from "next";
import { Inter } from "next/font/google";
import "./globals.css";
import { ThemeProvider } from "@/components/providers/theme-provider";
import { QueryProvider } from "@/components/providers/query-provider";
import { AppShell } from "@/components/layout/app-shell";
import { Toaster } from "@/components/ui/sonner";

const inter = Inter({ subsets: ["latin"] });

export const metadata: Metadata = {
  title: "Hermes - Virtual TV Channel Service",
  description: "Manage and stream your own virtual TV channels",
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en" suppressHydrationWarning>
      <body className={inter.className}>
        <ThemeProvider
          attribute="class"
          defaultTheme="system"
          enableSystem
          disableTransitionOnChange
        >
          <QueryProvider>
            <AppShell>{children}</AppShell>
          </QueryProvider>
          <Toaster />
        </ThemeProvider>
      </body>
    </html>
  );
}
```

### Step 6: Update MainLayout
Update `components/layout/main-layout.tsx` to remove redundant structure:
```typescript
import React from "react";
import { cn } from "@/lib/utils";

interface MainLayoutProps {
  children: React.ReactNode;
  className?: string;
}

export function MainLayout({ children, className }: MainLayoutProps) {
  return (
    <div className={cn("container mx-auto px-4 py-6", className)}>
      {children}
    </div>
  );
}
```

### Step 7: Create Navigation Utilities
Create `lib/utils/navigation.ts`:
```typescript
export function isActiveRoute(currentPath: string, itemPath: string): boolean {
  if (itemPath === "/") {
    return currentPath === "/";
  }
  return currentPath.startsWith(itemPath);
}
```

### Step 8: Test Navigation
- Test desktop navigation
- Test mobile menu open/close
- Test active link highlighting
- Test navigation between routes
- Test theme toggle in header
- Test keyboard navigation
- Test screen reader compatibility

### Step 9: Verify Responsive Design
- Test on mobile (320px, 375px, 425px)
- Test on tablet (768px, 1024px)
- Test on desktop (1280px, 1920px)
- Verify menu animations are smooth
- Check backdrop blur effect

### Step 10: Verify Accessibility
- Tab through navigation with keyboard
- Verify focus indicators are visible
- Test with screen reader
- Check ARIA labels
- Verify mobile menu closes on route change

## Test Plan

### Success Criteria
1. Navigation renders on all pages
2. Active route is highlighted correctly
3. Mobile menu opens and closes smoothly
4. Theme toggle works in header
5. Navigation is keyboard accessible
6. Mobile menu closes when route changes
7. Responsive design works across devices

### Manual Testing
1. **Desktop Navigation**
   - Click each nav link
   - Verify active state updates
   - Test theme toggle

2. **Mobile Navigation**
   - Open mobile menu
   - Click nav item
   - Verify menu closes
   - Test backdrop click to close

3. **Keyboard Navigation**
   - Tab through nav items
   - Press Enter to navigate
   - Verify focus states

4. **Responsive Behavior**
   - Resize browser window
   - Verify desktop nav shows at md breakpoint
   - Verify mobile menu shows below md breakpoint

## Verification

### Acceptance Criteria
- [ ] Header component created
- [ ] Mobile menu component created
- [ ] App shell component created
- [ ] Navigation config file created
- [ ] Header shows on all pages
- [ ] Logo links to home page
- [ ] Desktop navigation shows nav items
- [ ] Mobile menu button shows on small screens
- [ ] Mobile menu opens and closes
- [ ] Active route is highlighted
- [ ] Theme toggle accessible in header
- [ ] Mobile menu closes on route change
- [ ] Navigation is keyboard accessible
- [ ] Focus indicators are visible
- [ ] Screen reader compatible
- [ ] Smooth animations
- [ ] No layout shift on navigation
- [ ] No TypeScript errors

### Definition of Done
- All acceptance criteria met
- Navigation works seamlessly across devices
- Accessibility standards met
- Code follows best practices
- Responsive design is polished

## Files Modified

### New Files Created
- `lib/config/navigation.ts` - Navigation items configuration
- `components/layout/header.tsx` - Main header component
- `components/layout/mobile-menu.tsx` - Mobile menu drawer
- `components/layout/app-shell.tsx` - App shell wrapper
- `lib/utils/navigation.ts` - Navigation utility functions

### Files Modified
- `app/layout.tsx` - Added AppShell wrapper
- `components/layout/main-layout.tsx` - Simplified structure

## Notes

- Header uses sticky positioning for always-visible navigation
- Mobile menu uses Zustand store for state management
- Backdrop blur effect requires browser support
- Mobile menu prevents body scroll when open
- Active route highlighting works for nested routes
- Navigation items are centralized for easy maintenance
- Header has reduced opacity backdrop for glassmorphism effect
- Logo uses first letter of app name in colored square
- Mobile menu slides in from right side
- Desktop navigation uses subtle hover states

